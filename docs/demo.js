(()=>{var P=class{constructor({ctx:e,x:i,y:t,color:n,type:o}){this.ctx=e,this.x=i,this.y=t,this.color=n,this.type=o}render({magnitude:e,direction:i}){let{ctx:t}=this,n=-1*(e/2),o=n+e;t.translate(this.x,this.y),t.rotate(i),t.beginPath(),t.lineTo(n,0),t.lineTo(o,0),this.type==="ARROW"&&(t.moveTo(o,0),t.lineTo(o-7,-3),t.moveTo(o,0),t.lineTo(o-7,3)),t.closePath(),t.strokeStyle=this.color,t.stroke(),t.setTransform(1,0,0,1,0,0)}},E=P;var y=class{constructor({ctx:e,x:i,y:t,type:n}){this.ctx=e,this.x=i,this.y=t,this.type=n}render({magnitude:e,direction:i}){let{ctx:t}=this;switch(t.beginPath(),t.translate(this.x,this.y),t.arc(0,0,e/2,0,Math.PI*2),t.closePath(),this.type){case"DOT":{t.fillStyle=`HSL(${i}rad, 70%, 60%)`,t.fill();break}case"CIRCLE":{t.strokeStyle=`HSL(${i}rad, 70%, 60%)`,t.stroke();break}}t.setTransform(1,0,0,1,0,0)}},w=y;var x=class{constructor({ctx:e,x:i,y:t,spacing:n,pointsArray:o,pointsArrayIndex:p}){this.ctx=e,this.x=i,this.y=t,this.spacing=n,this.pointsArray=o,this.pointsArrayIndex=p}render({magnitude:e,direction:i}){let{ctx:t}=this;t.beginPath(),t.translate(this.x,this.y),t.rotate(i),t.translate(this.spacing/2,this.spacing/2),t.arc(0,0,e/2,0,Math.PI*2),t.closePath(),t.fillStyle=`HSL(${i}rad, 70%, 60%)`,t.fill(),t.setTransform(1,0,0,1,0,0)}},C=x;var b=class{constructor({ctx:e,x:i,y:t,color:n}){this.ctx=e,this.x=i,this.y=t,this.color=n}render({magnitude:e,direction:i}){let{ctx:t}=this;t.font="10px sans-serif",t.fillStyle=this.color,t.fillText(`(${this.x}, ${this.y})
m:${e.toFixed(2)} d:${i.toFixed(2)}`,this.x,this.y),t.setTransform(1,0,0,1,0,0)}},T=b;var M=class{constructor({ctx:e,x:i,y:t,color:n,spacing:o}){this.ctx=e,this.x=i,this.y=t,this.color=n,this.spacing=o}render({magnitude:e,direction:i}){let{ctx:t}=this,o=-1*(e/2)+e;t.translate(this.x,this.y),t.strokeStyle=this.color,t.fillStyle=this.color,t.beginPath(),t.arc(0,0,this.spacing/2,0,Math.PI*2),t.closePath(),t.stroke(),t.beginPath(),t.rotate(i),t.moveTo(o,0),t.arc(0,0,e,0,Math.PI*2),t.closePath(),t.fill(),t.setTransform(1,0,0,1,0,0)}},O=M;var D=(s,e)=>(Math.PI*2+Math.atan2(-1*e,s))%(Math.PI*2);function A(s){switch(s){case"ARROW":case"LINE":return E;case"DOT":case"CIRCLE":return w;case"SPACETIME":return C;case"EYE":return O;case"DEBUG":return T}}var H=3e4,g=class extends EventTarget{constructor(e){super();this.animationLoop=null;this.points=[];this.logicalMouseX=0;this.logicalMouseY=0;this.onMouseMove=e=>{this.updateWithMousePosition(e.offsetX,e.offsetY)};this.onTouchMove=e=>{e.preventDefault(),this.updateWithMousePosition(e.touches[0].pageX-this.pageOffsetX,e.touches[0].pageY-this.pageOffsetY)};this.render=()=>{this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.width,this.height);for(let e of this.points)e.element.render(this.getPointElementProperties(e)),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio);this.animationLoop=requestAnimationFrame(this.render)};this.updateWithMousePosition=(e,i)=>{let[t,n]=this.physicalToLogical(e,i);this.logicalMouseX=t,this.logicalMouseY=n};this.onWindowResize=()=>{this.setUpScene()};this.options=e;let i=e.el.getContext("2d");if(!i)throw new Error("Could not get canvas context");this.ctx=i,this.pageOffsetX=0,this.pageOffsetY=0,this.width=1,this.height=1}start(){this.setUpScene(),this.render(),this.options.el.addEventListener("mousemove",this.onMouseMove),this.options.el.addEventListener("touchmove",this.onTouchMove),window.addEventListener("resize",this.onWindowResize)}stop(){this.options.el.removeEventListener("mousemove",this.onMouseMove),this.options.el.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("resize",this.onWindowResize),this.animationLoop&&cancelAnimationFrame(this.animationLoop)}getPointElementProperties(e){let i=l=>{let h=this.options.timerPeriodMs||H,c=Date.now()/h%1;return new Function("x","y","mX","mY","t",`with (Math) { return ${l}; }`)(e.logicalX,e.logicalY,this.logicalMouseX,this.logicalMouseY,c)},t=i(this.options.xEquation),n=i(this.options.yEquation),o=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));return this.options.clamp!==void 0&&(o=Math.min(o,this.options.clamp)),{magnitude:o*this.options.spacing,direction:D(t,n)}}getLogicalBounds(){let e=this.width/this.height;return e>1?[[-1,-1/e],[1,1/e]]:[[e/-1,-1],[e/1,1]]}physicalToLogical(e,i){let[[t,n],[o,p]]=this.getLogicalBounds(),[l,h]=[this.width,this.height],c=e/l,d=1-i/h,v=t+(o-t)*c,f=n+(p-n)*d;return[v,f]}setUpScene(){let{el:e}=this.options,i=e.parentNode;if(!i||!(i instanceof HTMLElement))throw new Error("Parent element must be a HTMLElement");let t=i.getBoundingClientRect();this.width=t.width,this.height=t.height,this.pageOffsetX=t.x,this.pageOffsetY=t.y;let n=window.devicePixelRatio;e.width=this.width*n,e.height=this.height*n,this.ctx.scale(n,n),this.points=[];let o=this.options.spacing/2,{horizontalPadding:p,verticalPadding:l}=this.options,h=(this.width-p*2)%this.options.spacing/2,c=p+h,d=new CustomEvent("sizeChanged",{detail:{horizontalPadding:c}});this.dispatchEvent(d);let[v,f]=[o+c,o+l],[X,Y]=[this.width-o-c+1,this.height-o-l];for(let m=v;m<X;m+=this.options.spacing)for(let u=f;u<Y;u+=this.options.spacing){let I=A(this.options.type),S=new I({ctx:this.ctx,x:m,y:u,color:this.options.foregroundColor,type:this.options.type,spacing:this.options.spacing,pointsArray:this.points,pointsArrayIndex:this.points.length}),[k,z]=this.physicalToLogical(m,u);this.points.push({element:S,logicalX:k,logicalY:z,physicalX:m,physicalY:u})}}},R=g;window.VFCanvas=g;var L=document.querySelector(".app-canvas");if(!L)throw new Error("Missing .app-canvas element");var q=new URL(window.location.href),a=q.searchParams,r={vx:a.get("vx")||"(mX - x) * sin((2*t - 1) * PI)",vy:a.get("vy")||"(mY - y) * cos((2*t - 1) * PI)",bg:a.get("bg")||"#dd5555",fg:a.get("fg")||"#fff",type:a.get("type")||"DOT",l:a.get("l")||40,clamp:a.get("clamp"),paddingX:a.get("paddingX")||0,paddingY:a.get("paddingY")||0},F=r.clamp?parseFloat(r.clamp):void 0,W=new R({el:L,xEquation:r.vx,yEquation:r.vy,spacing:parseInt(r.l,10),foregroundColor:r.fg,backgroundColor:r.bg,type:r.type,clamp:F,horizontalPadding:parseInt(r.paddingX,10),verticalPadding:parseInt(r.paddingY,10)});W.start();var $=window.location.search===""||a.get("edit")==="true";if($){let s=document.querySelector(".config-form");if(!s)throw new Error("Missing .config-form element");for(let e of Object.keys(r)){let i=r[e],t=s.elements.namedItem(e);t&&(t.value=i)}s.style.display="block"}})();
