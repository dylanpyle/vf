(()=>{var P=class{constructor({ctx:i,x:e,y:t,color:o,type:n}){this.ctx=i,this.x=e,this.y=t,this.color=o,this.type=n}render({magnitude:i,direction:e}){let{ctx:t}=this,o=-1*(i/2),n=o+i;t.translate(this.x,this.y),t.rotate(e),t.beginPath(),t.lineTo(o,0),t.lineTo(n,0),this.type==="ARROW"&&(t.moveTo(n,0),t.lineTo(n-7,-3),t.moveTo(n,0),t.lineTo(n-7,3)),t.closePath(),t.strokeStyle=this.color,t.stroke(),t.setTransform(1,0,0,1,0,0)}},b=P;var v=class{constructor({ctx:i,x:e,y:t,type:o}){this.ctx=i,this.x=e,this.y=t,this.type=o}render({magnitude:i,direction:e}){let{ctx:t}=this;switch(t.beginPath(),t.translate(this.x,this.y),t.arc(0,0,i/2,0,Math.PI*2),t.closePath(),this.type){case"DOT":{t.fillStyle=`HSL(${e}rad, 70%, 60%)`,t.fill();break}case"CIRCLE":{t.strokeStyle=`HSL(${e}rad, 70%, 60%)`,t.stroke();break}}t.setTransform(1,0,0,1,0,0)}},M=v;var x=class{constructor({ctx:i,x:e,y:t,spacing:o,pointsArray:n,pointsArrayIndex:r}){this.ctx=i,this.x=e,this.y=t,this.spacing=o,this.pointsArray=n,this.pointsArrayIndex=r}render({magnitude:i,direction:e}){let{ctx:t}=this;t.beginPath(),t.translate(this.x,this.y),t.rotate(e),t.translate(this.spacing/2,this.spacing/2),t.arc(0,0,i/2,0,Math.PI*2),t.closePath(),t.fillStyle=`HSL(${e}rad, 70%, 60%)`,t.fill(),t.setTransform(1,0,0,1,0,0)}},E=x;var f=class{constructor({ctx:i,x:e,y:t,color:o}){this.ctx=i,this.x=e,this.y=t,this.color=o}render({magnitude:i,direction:e}){let{ctx:t}=this;t.font="10px sans-serif",t.fillStyle=this.color,t.fillText(`(${this.x}, ${this.y})
m:${i.toFixed(2)} d:${e.toFixed(2)}`,this.x,this.y),t.setTransform(1,0,0,1,0,0)}},C=f;var y=class{constructor({ctx:i,x:e,y:t,color:o,spacing:n}){this.ctx=i,this.x=e,this.y=t,this.color=o,this.spacing=n}render({magnitude:i,direction:e}){let{ctx:t}=this,n=-1*(i/2)+i;t.translate(this.x,this.y),t.strokeStyle=this.color,t.fillStyle=this.color,t.beginPath(),t.arc(0,0,this.spacing/2,0,Math.PI*2),t.closePath(),t.stroke(),t.beginPath(),t.rotate(e),t.moveTo(n,0),t.arc(0,0,i,0,Math.PI*2),t.closePath(),t.fill(),t.setTransform(1,0,0,1,0,0)}},w=y;var S=(s,i)=>(Math.PI*2+Math.atan2(-1*i,s))%(Math.PI*2);function I(s){switch(s){case"ARROW":case"LINE":return b;case"DOT":case"CIRCLE":return M;case"SPACETIME":return E;case"EYE":return w;case"DEBUG":return C}}var z=3e4,m=class extends EventTarget{constructor(i){super();this.animationLoop=null;this.points=[];this.logicalMouseX=0;this.logicalMouseY=0;this.onMouseMove=i=>{this.updateWithMousePosition(i.offsetX,i.offsetY)};this.onTouchMove=i=>{i.preventDefault(),this.updateWithMousePosition(i.touches[0].pageX-this.pageOffsetX,i.touches[0].pageY-this.pageOffsetY)};this.render=()=>{this.ctx.fillStyle=this.options.backgroundColor,this.ctx.fillRect(0,0,this.width,this.height);for(let i of this.points)i.element.render(this.getPointElementProperties(i)),this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio);this.animationLoop=requestAnimationFrame(this.render)};this.updateWithMousePosition=(i,e)=>{let[t,o]=this.physicalToLogical(i,e);this.logicalMouseX=t,this.logicalMouseY=o};this.onWindowResize=()=>{this.setUpScene()};this.options=i;let e=i.el.getContext("2d");if(!e)throw new Error("Could not get canvas context");this.ctx=e,this.pageOffsetX=0,this.pageOffsetY=0,this.width=1,this.height=1}start(){this.setUpScene(),this.render(),this.options.el.addEventListener("mousemove",this.onMouseMove),this.options.el.addEventListener("touchmove",this.onTouchMove),window.addEventListener("resize",this.onWindowResize)}stop(){this.options.el.removeEventListener("mousemove",this.onMouseMove),this.options.el.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("resize",this.onWindowResize),this.animationLoop&&cancelAnimationFrame(this.animationLoop)}getPointElementProperties(i){let e=p=>{let c=this.options.timerPeriodMs||z,a=Date.now()/c%1;return new Function("x","y","mX","mY","t",`with (Math) { return ${p}; }`)(i.logicalX,i.logicalY,this.logicalMouseX,this.logicalMouseY,a)},t=e(this.options.xEquation),o=e(this.options.yEquation),n=Math.sqrt(Math.pow(t,2)+Math.pow(o,2));return this.options.clamp!==void 0&&(n=Math.min(n,this.options.clamp)),{magnitude:n*this.options.spacing,direction:S(t,o)}}getLogicalBounds(){let i=this.width/this.height;return i>1?[[-1,-1/i],[1,1/i]]:[[i/-1,-1],[i/1,1]]}physicalToLogical(i,e){let[[t,o],[n,r]]=this.getLogicalBounds(),[p,c]=[this.width,this.height],a=i/p,u=1-e/c,d=t+(n-t)*a,g=o+(r-o)*u;return[d,g]}setUpScene(){let{el:i}=this.options,e=i.parentNode;if(!e||!(e instanceof HTMLElement))throw new Error("Parent element must be a HTMLElement");let t=e.getBoundingClientRect();this.width=t.width,this.height=t.height,this.pageOffsetX=t.x,this.pageOffsetY=t.y;let o=window.devicePixelRatio;i.width=this.width*o,i.height=this.height*o,this.ctx.scale(o,o),this.points=[];let n=this.options.spacing/2,{horizontalPadding:r,verticalPadding:p}=this.options,c=(this.width-r*2)%this.options.spacing/2,a=r+c,u=new CustomEvent("sizeChanged",{detail:{horizontalPadding:a}});this.dispatchEvent(u);let[d,g]=[n+a,n+p],[O,T]=[this.width-n-a+1,this.height-n-p];for(let h=d;h<O;h+=this.options.spacing)for(let l=g;l<T;l+=this.options.spacing){let R=I(this.options.type),X=new R({ctx:this.ctx,x:h,y:l,color:this.options.foregroundColor,type:this.options.type,spacing:this.options.spacing,pointsArray:this.points,pointsArrayIndex:this.points.length}),[L,Y]=this.physicalToLogical(h,l);this.points.push({element:X,logicalX:L,logicalY:Y,physicalX:h,physicalY:l})}}},_=m;window.VFCanvas=m;})();
